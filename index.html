<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Genesys Cloud – Email Bulk Actions (Auth Smoke Test)</title>
  <style>
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0b0d10;color:#e6edf3}
    .wrap{max-width:760px;margin:32px auto;padding:0 16px}
    .card{background:#11151a;border:1px solid #1f2630;border-radius:12px;padding:16px}
    label{font-size:12px;color:#9aa4b2;display:block;margin-bottom:6px}
    input,button{width:100%;box-sizing:border-box;border-radius:8px;border:1px solid #263041;background:#0e1217;color:#e6edf3;padding:10px 12px}
    button{cursor:pointer}
    button:hover{background:#1e2a3a}
    .muted{color:#9aa4b2;font-size:12px}
    textarea{width:100%;min-height:160px;background:#0a0d11;border:1px solid #263041;color:#e6edf3;border-radius:8px;padding:10px}
    .row{display:flex;gap:10px;align-items:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2 style="margin-top:0">Auth Smoke Test</h2>

      <div class="row">
        <div style="flex:1">
          <label>Region Host</label>
          <input id="region" value="mypurecloud.jp" />
        </div>
        <div style="flex:1">
          <label>Client ID</label>
          <input id="client" value="5ad8dc1d-2ee1-41dd-9771-1c0e58f22203" />
        </div>
      </div>

      <div style="margin-top:10px">
        <label>Redirect URI (must match OAuth app exactly)</label>
        <input id="redirect" value="https://chinarn.github.io/emailwizard/" />
        <div class="muted" id="where">Current page: </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="signin">Sign in</button>
        <button id="signout" style="display:none">Sign out</button>
      </div>

      <div style="margin-top:10px">
        <label>Access Token</label>
        <input id="token" readonly placeholder="(will appear after redirect)" />
      </div>

      <div style="margin-top:10px">
        <label>Run Log</label>
        <textarea id="log" readonly></textarea>
        <div id="err" class="muted" style="color:#ff9a9a"></div>
      </div>

      <div id="fallback" class="muted" style="margin-top:8px"></div>
    </div>
  </div>

  <script>
    (function(){
      var logEl = document.getElementById('log');
      function log(msg){
        try{
          var s = new Date().toLocaleTimeString();
          logEl.value = (logEl.value? logEl.value+"
":"") + s + " • " + msg;
          logEl.scrollTop = logEl.scrollHeight;
          console.log(msg);
        }catch(_){console.log(msg)}
      }
      function setErr(m){ document.getElementById('err').textContent = m || '' }

      function buildAuthUrl(){
        var region = document.getElementById('region').value;
        var client = document.getElementById('client').value;
        var redirect = document.getElementById('redirect').value;
        var base = 'https://login.' + region + '/oauth/authorize';
        var q = 'client_id=' + encodeURIComponent(client)
              + '&response_type=token'
              + '&redirect_uri=' + encodeURIComponent(redirect)
              + '&state=email_bulk_implicit';
        return base + '?' + q;
      }

      function readTokenFromHash(){
        if (!location.hash) return null;
        var h = location.hash.substring(1);
        var p = new URLSearchParams(h);
        var t = p.get('access_token');
        if (t) {
          history.replaceState({}, document.title, window.location.pathname + window.location.search);
          return { access_token: t };
        }
        return null;
      }

      function update(){
        var has = !!window.__token;
        document.getElementById('signin').style.display = has ? 'none' : 'inline-block';
        document.getElementById('signout').style.display = has ? 'inline-block' : 'none';
        document.getElementById('token').value = window.__token || '';
      }

      document.getElementById('where').textContent = 'Current page: ' + window.location.href;

      window.addEventListener('error', function(e){ log('ERROR: ' + (e && e.message ? e.message : String(e))); });
      window.addEventListener('unhandledrejection', function(e){ log('REJECTION: ' + (e.reason && e.reason.message ? e.reason.message : String(e.reason))); });

      var th = readTokenFromHash();
      if (th) { window.__token = th.access_token; log('Token parsed from hash'); }
      update();

      document.getElementById('signin').addEventListener('click', function(){
        try{
          setErr('');
          var url = buildAuthUrl();
          log('Navigating to: ' + url);
          var a = document.getElementById('fallback');
          a.innerHTML = '<a href="' + url + '">If nothing happens, click here to continue</a>';
          window.location.assign(url);
        }catch(e){ setErr(e && e.message ? e.message : String(e)); }
      });
      document.getElementById('signout').addEventListener('click', function(){ window.__token=''; update(); log('Signed out'); });
    })();
  </script>
</body>
</html>
